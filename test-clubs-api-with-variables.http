### Test Clubs API with Variables
### This file demonstrates how to use variables in .http files
### Run requests in order to automatically populate variables

@baseUrl = https://localhost:7227

### STEP 1: Login to get token
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "Email": "admin@example.com",
  "Password": "Admin@123"
}

###
@token = {{login.response.body.$.AccessToken}}

### STEP 2: Get communities list
# @name getCommunities
GET {{baseUrl}}/communities?page=1&size=10
Authorization: Bearer {{token}}

###
# Extract first community ID from response
@communityId = {{getCommunities.response.body.$.Items[0].Id}}

### STEP 3: Search clubs in the community
GET {{baseUrl}}/communities/{{communityId}}/clubs
Authorization: Bearer {{token}}

### STEP 4: Search clubs with filters
GET {{baseUrl}}/communities/{{communityId}}/clubs?name=gaming&isPublic=true&size=20
Authorization: Bearer {{token}}

### STEP 5: Search clubs with member count filter
GET {{baseUrl}}/communities/{{communityId}}/clubs?membersFrom=0&membersTo=100
Authorization: Bearer {{token}}

### STEP 6: Create a new club
# @name createClub
POST {{baseUrl}}/communities/{{communityId}}/clubs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "Name": "Elite Gamers Club",
  "Description": "A club for serious competitive gamers",
  "IsPublic": true
}

###
@clubId = {{createClub.response.body.$}}

### STEP 7: Get the newly created club
GET {{baseUrl}}/communities/{{communityId}}/clubs/{{clubId}}
Authorization: Bearer {{token}}

### STEP 8: Create another club
POST {{baseUrl}}/communities/{{communityId}}/clubs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "Name": "Casual Players Club",
  "Description": "A club for casual gaming sessions",
  "IsPublic": false
}

### STEP 9: Test rate limiting (try to create more than 10 clubs in a day)
### This should eventually return 429 Too Many Requests
POST {{baseUrl}}/communities/{{communityId}}/clubs
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "Name": "Test Rate Limit Club",
  "Description": "Testing rate limits",
  "IsPublic": true
}

### STEP 10: Search with cursor pagination
GET {{baseUrl}}/communities/{{communityId}}/clubs?size=5
Authorization: Bearer {{token}}

### Get next page using cursor from previous response
GET {{baseUrl}}/communities/{{communityId}}/clubs?size=5&cursor=YOUR_CURSOR_FROM_PREVIOUS_RESPONSE
Authorization: Bearer {{token}}
